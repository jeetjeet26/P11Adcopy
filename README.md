# P11RAG - Microservices RAG System

A production-ready Retrieval-Augmented Generation (RAG) system split into focused microservices for better maintainability and scalability.

## Architecture Overview

This system is now split into two focused services:

### üóÑÔ∏è Knowledge Base Service (`ad-agency-kb/`)
**Port: 3000**
- Document upload and processing
- Semantic text chunking with overlap
- Vector embedding generation
- Client asset management
- Multi-format file support (PDF, DOCX, TXT, images)

### üéØ Campaign Service (`campaign-service/`)
**Port: 3001**
- AI-powered campaign generation
- Context-aware content creation
- Campaign management and history
- OpenAI Assistant API integration

## Benefits of Separation

‚úÖ **Single Responsibility** - Each service has one clear purpose  
‚úÖ **Independent Development** - Teams can work separately  
‚úÖ **Better Testing** - Isolated functionality is easier to test  
‚úÖ **Flexible Deployment** - Deploy services independently  
‚úÖ **Reusable Knowledge Base** - Vector DB can serve multiple applications  

## Shared Infrastructure

Both services share the same Supabase database:
- **Vector Storage**: Semantic chunks with embeddings
- **Client Management**: Multi-tenant organization
- **Direct Database Access**: No API overhead between services

## Quick Start

### 1. Knowledge Base Service
```bash
cd ad-agency-kb
npm install
npm run dev  # Runs on http://localhost:3000
```

### 2. Campaign Service
```bash
cd campaign-service
npm install
npm run dev  # Runs on http://localhost:3001
```

## Environment Setup

Both services need `.env.local` files with:
```env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
OPENAI_API_KEY=your_openai_api_key
```

Campaign service additionally needs:
```env
OPENAI_ASSISTANT_ID=your_openai_assistant_id
```

## Database Schema

### Shared Tables
- `clients` - Client information
- `sources` - Document metadata
- `chunks` - Vector embeddings (generated by Knowledge Base)

### Campaign-Specific Tables
- `campaigns` - Generated marketing campaigns

## Workflow

1. **Upload Documents** ‚Üí Knowledge Base Service processes and stores
2. **Generate Campaigns** ‚Üí Campaign Service queries vector DB and creates content
3. **Manage Assets** ‚Üí Both services can view/manage client data

## Technology Stack

- **Framework**: Next.js 14 with TypeScript
- **Database**: Supabase (PostgreSQL + pgvector)
- **AI**: OpenAI (embeddings + assistant)
- **File Processing**: pdf-parse, mammoth, tesseract.js
- **Styling**: Tailwind CSS

## Development

Each service can be developed and deployed independently while sharing the same database layer. This architecture supports:

- **Horizontal Scaling**: Scale services based on demand
- **Technology Diversity**: Use different stacks for different services
- **Team Specialization**: Different teams for document processing vs content generation

## Migration Notes

The original monolithic application has been split while maintaining:
- ‚úÖ All existing functionality
- ‚úÖ Same database structure
- ‚úÖ Same user experience
- ‚úÖ Improved chunking strategy
- ‚úÖ Better separation of concerns 